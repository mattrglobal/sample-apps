<!doctype html>
<html>
  <head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>2FA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
      }
      h1 {
        font-size: 2em;
        margin-top: 3em;
        margin-bottom: 4em;
      }
      .contents {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
      }
      /* input pin */
      code-input {
        display: flex;
        flex-direction: column;
        align-items: start;
      }
      .code-label {
        margin-bottom: 16px;
      }
      .code-inputs {
        display: flex;
        justify-content: start;
        align-items: center;
      }
      .code-inputs input {
        border: none;
        background-image: none;
        background-color: transparent;
        -webkit-box-shadow: none;
        -moz-box-shadow: none;
        box-shadow: none;
        text-align: center;
        height: 60px;
        width: 40px;
        border-radius: 10px;
        margin: 0 4px;
        border: 2px solid #4f5b66;
        font-size: 38px;
      }
      .code-inputs input:focus {
        outline: none;
      }
      .code-inputs input:nth-child(3n) {
        margin-right: 24px;
      }
    </style>
  </head>
  <body>
    <div class="contents">
      <h1><strong>UI for interaction-hook</strong></h1>
      <h2>Enter your 6 digit verification code</h2>
        <div class="code-input">
          <div class="code-inputs">
            <input type="text" placeholder="2" disabled />
            <input type="text" placeholder="4" disabled />
            <input type="text" placeholder="2" disabled />
            <input type="text" placeholder="5" disabled />
            <input type="text" placeholder="1" disabled />
            <input type="text" placeholder="7" disabled />
          </div>
        </div>
      <br>
      <button type="button" onclick="redirectToWallet()" class="btn btn-primary btn-lg">Verify</button>
    </div>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <script>
    // Retrieving session_token from query parameter -> that's the jwt
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const jwt = urlParams.get('session_token')
    console.log(jwt);

    // Decoding JWT -> no library needed
    const parseJwt = (token) => {
      try {
        return JSON.parse(atob(token.split('.')[1]));
      } catch (e) {
        return null;
      }
    };

    // Decode jwt
    const decoded = parseJwt(jwt);

    // Get redirectUrl from the decoded jwt
    const redirectUrl = decoded.redirectUrl;

    // Verifying the token
    // First, verify if decoded.iss is the same issuer as the tenant by making a call to your tenant
    // Secondly, verify if decoded.aud is the same audience as our tenant if you make a call to your tenant again

    // Responsible for redirecting users back to their wallet after 2FA/MFA-check
    const redirectToWallet = () => {
      console.log(`Getting redirectUrl`);

      // redirectUrl needs a jwt as session_token as a query parameter
      // For simplicity, we can keep use the same jwt as we got from the session_token from the URL that took us onto this page
      location.replace(`${redirectUrl}?session_token=${jwt}`);
    };
  </script>
</html>